{"remainingRequest":"C:\\Users\\Ray\\WebstormProjects\\vote_app4\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Ray\\WebstormProjects\\vote_app4\\src\\views\\detail.vue?vue&type=style&index=0&id=7b1556cf&scoped=true&lang=css&","dependencies":[{"path":"C:\\Users\\Ray\\WebstormProjects\\vote_app4\\src\\views\\detail.vue","mtime":1577811394237},{"path":"C:\\Users\\Ray\\WebstormProjects\\vote_app4\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Ray\\WebstormProjects\\vote_app4\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\Ray\\WebstormProjects\\vote_app4\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\Ray\\WebstormProjects\\vote_app4\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Ray\\WebstormProjects\\vote_app4\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5kZXRhaWwgewogICAgbWFyZ2luLXRvcDogMzBweDsKICAgIG1hcmdpbi1ib3R0b206IDkwcHg7Cn0KCi5kZXRhaWwgaW1nIHsKICAgIG1hcmdpbjogOHB4IDhweDsKfQoKLmRlc2NyaXB0aW9uIHsKICAgIG1hcmdpbjogOHB4IDhweDsKICAgIGZvbnQtc2l6ZTogc21hbGw7Cn0KCi5vcHRpb25zIHsKICAgIG1hcmdpbjogM3B4IDhweDsKfQoKLm9wdGlvbi1jb250ZW50IHsKICAgIG1hcmdpbjogOHB4IDhweDsKfQoKLnZvdGVudW0gewogICAgbWFyZ2luOiAzcHg7Cn0KCi52b3RlYnV0dG9uIHsKICAgIHdpZHRoOiAxNjBweDsKICAgIGRpc3BsYXk6IGJsb2NrOwogICAgbWFyZ2luLXRvcDogMTJweDsKCn0KCiN0aXRsZUltZyB7CiAgICBtYXJnaW4tbGVmdDogOHB4OwogICAgbWFyZ2luLXRvcDogNnB4Cn0KCiN0aXRsZSB7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIG1hcmdpbjogNnB4IDBweAp9CgojY3JlYXRvckluZm8gewogICAgbWFyZ2luOiA1cHggOHB4Cn0KCiNjcmVhdG9ySW5mbyAjczEgewogICAgY29sb3I6ICM5Njk3OTk7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIGZvbnQtc2l6ZTogeC1zbWFsbDsKICAgIG1hcmdpbi10b3A6IDNweAp9CgojY3JlYXRvckluZm8gI3MxIHsKICAgIGRpc3BsYXk6IGJsb2NrOwp9CgojZGVhZGxpbmUgewogICAgZm9udC1zaXplOiB4LXNtYWxsOwogICAgbWFyZ2luLWxlZnQ6IDhweDsKfQoKI3Byb21wdCB7CiAgICBmb250LXNpemU6IHgtc21hbGw7CiAgICBjb2xvcjogIzk2OTc5OTsKICAgIG1hcmdpbi1sZWZ0OiA4cHg7CiAgICBtYXJnaW4tYm90dG9tOiA4cHg7Cn0KCiN0YWIxIHsKICAgIHdpZHRoOiAxNjBweDsKfQoKI3RhYjIgewogICAgd2lkdGg6IDgwcHg7Cn0KCmhyIHsKICAgIG1hcmdpbjogMHB4IDhweDsKICAgIGJvcmRlcjogMDsKICAgIGNvbG9yOiAjZTBlMGUwOwogICAgYmFja2dyb3VuZC1jb2xvcjogI2UwZTBlMDsKICAgIGhlaWdodDogMXB4Cn0K"},{"version":3,"sources":["detail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+QA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"detail.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n    <div class=\"detail\">\r\n        <van-row>\r\n            <van-col span=\"2\">\r\n                <img id=\"titleImg\" src=\"../assets/images/h1.png\" height=\"24px\" width=\"24px\"/>\r\n            </van-col>\r\n            <van-col span=\"22\">\r\n                <span id=\"title\">{{vote.title}}</span>\r\n            </van-col>\r\n        </van-row>\r\n        <div class=\"d-flex\" id=\"creatorInfo\">\r\n            <van-image\r\n                    round\r\n                    fit=\"none\"\r\n                    width=\"3rem\"\r\n                    height=\"3rem\"\r\n                    :src=avatarUrl\r\n                    style=\"margin-right: 12px\"\r\n            />\r\n            <div>\r\n                <span id=\"s1\">投票发起人</span>\r\n                <span id=\"s2\">{{vote.creator.userName}}</span>\r\n            </div>\r\n        </div>\r\n        <div id=\"deadline\">截止时间：{{vote.deadline}}</div>\r\n        <div id=\"prompt\">(提示：点击选项可查看详情，投票结果于投票后可见)</div>\r\n        <hr>\r\n        <img :src=descriptionImgUrl>\r\n        <div class=\"description\" v-if=\"vote.description!=null\">{{vote.description}}</div>\r\n        <div class=\"description\" v-else>暂无说明</div>\r\n        <hr>\r\n        <van-tabs v-model=\"active\" id=\"tab1\">\r\n            <van-tab title=\"默认排序\" style=\"width: 400px\">\r\n                <div class=\"options d-flex\" v-for=\"(item,i) in optionList\" :key=i>\r\n                    <img height=\"64px\" width=\"64px\" :src=item.img>\r\n                    <div class=\"option-content\">\r\n                        <div>{{item.content}}</div>\r\n                        <div class=\"d-flex justify-content-end\">\r\n                            <div class=\"progress\" style=\"width: 240px;margin-top: 8px\">\r\n                                <div class=\"progress-bar\" role=\"progressbar\" :style=\"{width: item.percent+'%'}\"\r\n                                     aria-valuenow=\"25\" aria-valuemin=\"0\" aria-valuemax=\"100\">{{item.percent}} %\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"votenum\">{{item.votes}}票</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </van-tab>\r\n            <van-tab title=\"票数排序\" style=\"width: 400px\">\r\n                <div class=\"options d-flex\" v-for=\"(item,i) in optionListSort\" :key=i>\r\n                    <img height=\"64px\" width=\"64px\" :src=item.img>\r\n                    <div class=\"option-content\">\r\n                        <div>{{item.content}}</div>\r\n                        <div class=\"d-flex justify-content-end\">\r\n                            <div class=\"progress\" style=\"width: 240px;margin-top: 8px\">\r\n                                <div class=\"progress-bar\" role=\"progressbar\" :style=\"{width: item.percent+'%'}\"\r\n                                     aria-valuenow=\"25\" aria-valuemin=\"0\" aria-valuemax=\"100\">{{item.percent}} %\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"votenum\">{{item.votes}}票</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </van-tab>\r\n        </van-tabs>\r\n        <hr>\r\n        <van-tabs v-model=\"active\" id=\"tab2\">\r\n            <van-tab title=\"参与投票\" style=\"width: 400px\">\r\n                <van-radio-group v-model=\"isSelect\">\r\n                    <van-grid :border=\"false\" :column-num=\"2\">\r\n                        <van-grid-item v-for=\"(item,i) in optionList\" :key=i>\r\n                            <van-image\r\n                                    width=\"160\"\r\n                                    height=\"160\"\r\n                                    lazy-load\r\n                                    :src=item.img\r\n                                    fit=\"cover\"\r\n                                    style=\"margin: 5px\"\r\n                                    radius=\"5px\"\r\n                            />\r\n                            <div class=\"d-flex justify-content-start\" style=\"width: 160px\">\r\n                                <van-radio :name=item.id>{{item.content}}</van-radio>\r\n                            </div>\r\n                        </van-grid-item>\r\n                    </van-grid>\r\n                </van-radio-group>\r\n                <div class=\"d-flex justify-content-between\" style=\"margin: 8px\">\r\n                    <span>选择投票数</span>\r\n                    <van-stepper v-model=\"onceVoteNum\" integer :max=\"vote.onceMaxVote\"/>\r\n                </div>\r\n            </van-tab>\r\n        </van-tabs>\r\n\r\n        <div class=\"d-flex justify-content-center\">\r\n            <van-button class=\"votebutton\" type=\"info\" @click=\"doVote()\">投票</van-button>\r\n        </div>\r\n        <div class=\"d-flex justify-content-center\">\r\n            <van-button class=\"votebutton\" plain type=\"info\">分享投票</van-button>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    export default {\r\n        name: \"detail\",\r\n        data() {\r\n            return {\r\n                isLogin:false,\r\n                loginUser:{},\r\n                isSelect: '',\r\n                voteId: '',\r\n                vote: {},\r\n                descriptionImgUrl: '',\r\n                active: 0,\r\n                optionList: [],\r\n                optionListSort: [],\r\n                onceVoteNum: '',\r\n                avatarUrl:''\r\n            }\r\n        },\r\n        methods: {\r\n            async getVote(voteId) {\r\n                let that = this;\r\n                let url = this.website+\"/vote/getVoteById\"\r\n                await this.axios.get(url, {\r\n                    params: {\r\n                        voteId: voteId\r\n                    }\r\n                }).then(function (response) {\r\n                    if (response.data.code == 200) {\r\n                        that.vote = response.data.data;\r\n                        // console.log(that.vote);\r\n                    } else {\r\n                        console.log(\"投票信息查询失败\");\r\n                    }\r\n                }).catch(function (err) {\r\n                    // eslint-disable-next-line no-console\r\n                    console.log(err);\r\n                })\r\n            },\r\n            async getOption(voteId) {\r\n                let that = this;\r\n                let url = this.website+\"/option/getOption\"\r\n                await this.axios.get(url, {\r\n                    params: {\r\n                        voteId: voteId\r\n                    }\r\n                }).then(function (response) {\r\n                    if (response.data.code == 200) {\r\n                        that.optionList = response.data.data;\r\n                    } else {\r\n                        console.log(\"选项查询失败\");\r\n                    }\r\n                }).catch(function (err) {\r\n                    // eslint-disable-next-line no-console\r\n                    console.log(err);\r\n                })\r\n            },\r\n            doVote() {\r\n                // console.log(this.isSelect)\r\n                // console.log(this.onceVoteNum)\r\n                if(this.isLogin==false){\r\n                    this.$dialog.confirm({\r\n                        message: '登录之后才能进行投票，点击确认立即前往登录'\r\n                    }).then(() => {\r\n                        // on confirm\r\n                        window.location.href = '/login';\r\n                    }).catch(() => {\r\n                        // on cancel\r\n                    });\r\n                }else {\r\n                    if(this.isSelect==''){\r\n                        this.$dialog.alert({\r\n                            message: '请选择一项'\r\n                        }).then(() => {\r\n                            // on close\r\n                        });\r\n                    }else{\r\n                        let updateVoterUrl=this.website+\"/vote/doVote\";\r\n                        let config = {\r\n                            headers: { //添加请求头\r\n                                \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n                            }\r\n                        };\r\n                        let params = new FormData(); //创建form对象\r\n                        params.append(\"userId\", this.loginUser.id);\r\n                        params.append(\"voteId\", this.voteId);\r\n                        params.append(\"optionId\", this.isSelect);\r\n                        params.append(\"voteNum\", this.onceVoteNum);\r\n                        this.axios.put(updateVoterUrl,params,config).then(function (response) {\r\n                            if (response.data.code == 200) {\r\n                                this.$dialog.alert({\r\n                                    message: '投票成功'\r\n                                }).then(() => {\r\n                                    // on close\r\n                                    window.location.href = '/detail';\r\n                                });\r\n                                console.log(\"投票信息修改成功\");\r\n                            } else {\r\n                                console.log(\"投票信息修改失败\");\r\n                            }\r\n                        }).catch(function (err) {\r\n                            console.log(err);\r\n                        })\r\n\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        async mounted() {\r\n            // this.voteId = this.$route.params.voteId;\r\n            this.voteId=this.$route.query.voteId;\r\n            await this.getVote(this.voteId);\r\n            await this.getOption(this.voteId);\r\n            for (let i in this.optionList) {\r\n                this.optionListSort[i] = this.optionList[i];\r\n            }\r\n            // this.descriptionImgUrl='D:/uploadFiles/'+this.vote.descriptionImg;\r\n            let voteSum = 0;\r\n            for (let i in this.optionList) {\r\n                voteSum += this.optionList[i].votes;\r\n                this.optionList[i].img=this.imgUrl+this.optionList[i].img;\r\n            }\r\n            for (let i in this.optionListSort) {\r\n                this.optionListSort[i].img=this.imgUrl+this.optionListSort[i].img;\r\n            }\r\n            if(voteSum==0){\r\n                for (let j in this.optionList) {\r\n                    this.optionList[j].percent = 0;\r\n                }\r\n            }else {\r\n                for (let j in this.optionList) {\r\n                    let a = (this.optionList[j].votes / voteSum) * 100;\r\n                    this.optionList[j].percent = a.toFixed(2);\r\n                }\r\n            }\r\n            this.optionList.sort(function (x, y) {\r\n                if (x.content < y.content) {\r\n                    return -1;\r\n                }\r\n                if (x.content > y.content) {\r\n                    return 1;\r\n                }\r\n                return 0;\r\n            })\r\n            this.optionListSort.sort(function (x, y) {\r\n                if (x.votes < y.votes) {\r\n                    return 1;\r\n                }\r\n                if (x.votes > y.votes) {\r\n                    return -1;\r\n                }\r\n                return 0;\r\n            })\r\n            /*获取当前登录用户信息*/\r\n            if (sessionStorage.getItem(\"loginUser\") != null || localStorage.getItem(\"loginUser\") != null) {\r\n                this.isLogin = true;\r\n                if (sessionStorage.getItem(\"loginUser\") != null) {\r\n                    this.loginUser = JSON.parse(sessionStorage.getItem(\"loginUser\"));\r\n                }\r\n                if (localStorage.getItem(\"loginUser\") != null) {\r\n                    this.loginUser = JSON.parse(localStorage.getItem(\"loginUser\"));\r\n                }\r\n            }\r\n            this.avatarUrl=this.imgUrl+this.loginUser.avatar;\r\n            this.descriptionImgUrl=this.imgUrl+this.vote.descriptionImg;\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    .detail {\r\n        margin-top: 30px;\r\n        margin-bottom: 90px;\r\n    }\r\n\r\n    .detail img {\r\n        margin: 8px 8px;\r\n    }\r\n\r\n    .description {\r\n        margin: 8px 8px;\r\n        font-size: small;\r\n    }\r\n\r\n    .options {\r\n        margin: 3px 8px;\r\n    }\r\n\r\n    .option-content {\r\n        margin: 8px 8px;\r\n    }\r\n\r\n    .votenum {\r\n        margin: 3px;\r\n    }\r\n\r\n    .votebutton {\r\n        width: 160px;\r\n        display: block;\r\n        margin-top: 12px;\r\n\r\n    }\r\n\r\n    #titleImg {\r\n        margin-left: 8px;\r\n        margin-top: 6px\r\n    }\r\n\r\n    #title {\r\n        display: block;\r\n        margin: 6px 0px\r\n    }\r\n\r\n    #creatorInfo {\r\n        margin: 5px 8px\r\n    }\r\n\r\n    #creatorInfo #s1 {\r\n        color: #969799;\r\n        display: block;\r\n        font-size: x-small;\r\n        margin-top: 3px\r\n    }\r\n\r\n    #creatorInfo #s1 {\r\n        display: block;\r\n    }\r\n\r\n    #deadline {\r\n        font-size: x-small;\r\n        margin-left: 8px;\r\n    }\r\n\r\n    #prompt {\r\n        font-size: x-small;\r\n        color: #969799;\r\n        margin-left: 8px;\r\n        margin-bottom: 8px;\r\n    }\r\n\r\n    #tab1 {\r\n        width: 160px;\r\n    }\r\n\r\n    #tab2 {\r\n        width: 80px;\r\n    }\r\n\r\n    hr {\r\n        margin: 0px 8px;\r\n        border: 0;\r\n        color: #e0e0e0;\r\n        background-color: #e0e0e0;\r\n        height: 1px\r\n    }\r\n</style>"]}]}